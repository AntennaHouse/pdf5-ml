<?xml version="1.0" encoding="UTF-8"?>
<project>
    <property name="jp.acme-corporation.pdf.ml.plugin.folder" value="jp.acme-corporation.pdf.ml"/>
    <property name="jp.acme-corporation.pdf.ml.dir" value="plugins"/>
    
    <!-- Set property not to copy image -->
    <!--
    <condition property="build-step.copy-image" value="false">
        <equals arg1="${transtype}" arg2="acme-corporation.pdf.ml" casesensitive="false"/>
    </condition>
    
    <condition property="build-step.copy-html" value="false">
        <equals arg1="${transtype}" arg2="acme-corporation.pdf.ml" casesensitive="false"/>
    </condition>
    -->
    
    <target name="dita2acme-corporation.pdf.ml.init">
        <echo message="$otversion=${otversion}"/>
        <echo message="$dita.dir=${dita.dir}"/>
    </target>
    
    <target name="dita2acme-corporation.pdf.ml" depends="dita2acme-corporation.pdf.ml.init, build-init, preprocess, map2acme-corporation.pdf.ml, topic2acme-corporation.pdf.ml"/> 
    
    <target name="topic2acme-corporation.pdf.ml" if="noMap" depends="preprocess">
        <echo message="[acme.pdf] This plugin does not support topic formatting. Use map or bookmap!"/>
    </target>
    
    <target name="map2acme-corporation.pdf.ml" unless="noMap" depends="preprocess">
        <!-- Call Java TopicMerge -->
        <echo message="Start generating merged middle file."/>
        <dirname property="dita.temp.dir.fullpath" file="${dita.temp.dir}${file.separator}dummy.file"/>
        <pipeline message="topicmerge" 
            inputmap="${dita.temp.dir.fullpath}${file.separator}${user.input.file}"
            tempdir="${dita.temp.dir.fullpath}">
            <module class="org.dita.dost.module.TopicMergeModule">
                <param name="output" location="${dita.temp.dir.fullpath}${file.separator}${dita.map.filename.root}_MERGED.xml"></param>
            </module>
        </pipeline>
        
        <!-- Merged middle file to PDF -->
        <ant dir="${dita.dir}${file.separator}${jp.acme-corporation.pdf.ml.dir}${file.separator}${jp.acme-corporation.pdf.ml.plugin.folder}" target="merged2pdf">
            <property name="caller.basedir" value="${basedir}"/>
        </ant>
    </target>
</project>

